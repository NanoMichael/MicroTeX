name: Ubuntu

on:
  push:
    branches:
      - master
      - openmath
      - wasm
  pull_request:
    branches:
      - master
      - openmath

jobs:
  build_by_meson:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os:
          - ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - name: Downloading dependencies ðŸ“¥
        run: |
          sudo apt-get install build-essential meson libgtksourceviewmm-3.0-dev libgtkmm-3.0-dev
          sudo apt-get install qt5-default qttools5-dev-tools
      - name: Configure ðŸ”§
        run: meson _build
      - name: Compile ðŸŽ²
        run: ninja -C _build
      - name: Compress build artifacts ðŸ“¦
        run: |
          pushd _build
          tar -c * | zstd -o $GITHUB_WORKSPACE/artifacts.tar.zst
          popd
      - name: Upload build artifacts ðŸ“¤
        uses: actions/upload-artifact@v1
        with:
          name: Build artifacts
          path: artifacts.tar.zst

  build_by_cmake:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os:
          - ubuntu-20.04
    steps:
      - name: Downloading Source Code ðŸ“¥
        uses: actions/checkout@v2
      - name: Downloading dependencies ðŸ“¥
        run: |
          sudo apt-get install build-essential meson libgtksourceviewmm-3.0-dev libgtkmm-3.0-dev
          sudo apt-get install qt5-default qttools5-dev-tools
      - name: Configure ðŸ”§
        run: |
          cd ${{ github.workspace }}
          mkdir build
          cd build
          cmake .. -DCMAKE_BUILD_TYPE=Release -DGTK=ON -DBUILD_EXAMPLE_GTK=ON -DQT=ON -DBUILD_EXAMPLE_QT=ON -DBUILD_EXAMPLE_QTPNG=ON -DBUILD_EXAMPLE_MEMCHECK=ON -DWASM=OFF -DHAVE_LOG=ON -G Ninja
      - name: Compile ðŸŽ²
        run: |
          cd ${{ github.workspace }}
          cd build
          ninja
